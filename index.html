<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ—©é¤åº—é»é¤</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
  <div id="app" class="p-4 max-w-md mx-auto">
    <h1 class="text-2xl font-bold mb-4 text-center">æ—©é¤åº—é»é¤</h1>

    <div v-if="loading">ğŸ³ èœå–®è¼‰å…¥ä¸­...</div>

    <div v-else>
      <div v-for="item in sortedMenu" :key="item.id" class="bg-white p-4 mb-3 rounded shadow">
        <div class="font-semibold">{{ item.id }}.{{ item.name }}</div>
        <div class="text-sm text-gray-600">NT$ {{ item.price }}</div>
        <button @click="addToCart(item)" class="mt-2 bg-blue-500 text-white px-3 py-1 rounded">
          åŠ å…¥è³¼ç‰©è»Š
        </button>
      </div>

      <hr class="my-4" />

      <h2 class="text-xl font-bold mb-2">ğŸ›’ è³¼ç‰©è»Š</h2>
      <div v-if="cart.length === 0">ç›®å‰å°šæœªé¸æ“‡å“é …</div>
      <ul>
        <li v-for="(item, index) in cart" :key="index" class="mb-1">
          {{ item.id }}.{{ item.name }} - NT$ {{ item.price }}
          <button @click="removeFromCart(index)" class="ml-2 text-red-500">ç§»é™¤</button>
        </li>
      </ul>
      <div class="mt-2 font-bold">ç¸½é‡‘é¡ï¼šNT$ {{ total }}</div>

      <button
        v-if="cart.length > 0"
        @click="submitOrder"
        class="mt-4 bg-green-500 text-white px-4 py-2 rounded"
      >
        âœ… é€å‡ºè¨‚å–®
      </button>

      <div v-if="orderSubmitted" class="mt-4 text-green-600 font-semibold">
        è¨‚å–®å·²é€å‡ºï¼æ„Ÿè¬æ‚¨çš„é»é¤ ğŸ™Œ
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          menu: [],
          cart: [],
          loading: true,
          orderSubmitted: false
        };
      },
      computed: {
        total() {
          return this.cart.reduce((sum, item) => sum + Number(item.price), 0);
        },
        sortedMenu() {
          return this.menu.slice().sort((a, b) => {
            const isANum = /^\d+$/.test(a.id);
            const isBNum = /^\d+$/.test(b.id);

            if (isANum && !isBNum) return 1;
            if (!isANum && isBNum) return -1;

            return a.id.localeCompare(b.id, 'zh-Hant', { numeric: true });
          });
        }
      },
      methods: {
        addToCart(item) {
          this.cart.push(item);
        },
        removeFromCart(index) {
          this.cart.splice(index, 1);
        },
        submitOrder() {
          console.log("è¨‚å–®å…§å®¹ï¼š", this.cart);
          this.orderSubmitted = true;
          this.cart = [];
        }
      },
      mounted() {
        fetch("https://script.google.com/macros/s/AKfycbxW0AUm2IfUhM-bWT-SpcMezqtr-NS1l4omfCwT24-sGbIwmYDWdbu8J4NeAZogdDTN/exec")
          .then(res => res.json())
          .then(data => {
            this.menu = data;
            this.loading = false;
          })
          .catch(err => {
            console.error("è¼‰å…¥èœå–®å¤±æ•—", err);
            this.loading = false;
          });
      }
    }).mount("#app");
  </script>
</body>
</html>