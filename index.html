<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è·¯æ˜“å£«æ—©é¤å§</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>body { font-family: 'Noto Sans TC', sans-serif; }</style>
</head>
<body class="bg-blue-50">
  <div id="app" class="p-4 max-w-md mx-auto">
    <h1 class="text-3xl font-extrabold text-blue-900 mb-6 text-center tracking-wide">
      è·¯æ˜“å£«æ—©é¤å§
    </h1>

    <div v-if="loading">ğŸ³ èœå–®è¼‰å…¥ä¸­...</div>

    <div v-else>
      <div v-for="item in sortedMenu" :key="item.id" class="bg-white p-4 mb-4 rounded-lg shadow hover:shadow-lg transition">
        <div class="text-lg font-semibold text-gray-800">{{ item.id }}. {{ item.name }}</div>
        <div class="text-sm text-gray-500">NT$ {{ item.price }}</div>
        <button @click="addToCart(item)" class="mt-3 bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-full transition">
          åŠ å…¥è³¼ç‰©è»Š
        </button>
      </div>
    </div>

    <!-- æ‡¸æµ®å¼è³¼ç‰©è»Šé¢æ¿ -->
    <div v-if="showCartPanel"
      class="fixed bottom-24 right-6 w-80 bg-white shadow-xl rounded-lg p-4 z-50 transition">
      <h2 class="text-xl font-bold mb-2">ğŸ›’ è³¼ç‰©è»Š</h2>
      <div v-if="cart.length === 0">ç›®å‰å°šæœªé¸æ“‡å“é …</div>
      <ul>
        <li v-for="(item, index) in cart" :key="index" class="mb-2">
          {{ item.id }}. {{ item.name }} - NT$ {{ item.price }}
          <button @click="removeFromCart(index)" class="ml-2 text-red-500">ç§»é™¤</button>
        </li>
      </ul>

      <!-- æ¡Œè™Ÿè¼¸å…¥æ¬„ä½ -->
      <div class="mt-4">
        <label for="table" class="block text-sm font-medium text-gray-700">æ¡Œè™Ÿ</label>
        <input id="table" v-model="tableNumber" type="text"
          placeholder="ä¾‹å¦‚ï¼šA1ã€5è™Ÿæ¡Œ"
          class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
      </div>

      <div class="mt-2 font-bold">ç¸½é‡‘é¡ï¼šNT$ {{ total }}</div>
      <button @click="submitOrder"
        class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">
        âœ… é€å‡ºè¨‚å–®
      </button>
    </div>

    <!-- è³¼ç‰©è»Šæµ®å‹•æŒ‰éˆ• -->
    <button @click="toggleCartPanel"
      class="fixed bottom-6 right-6 bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full shadow-lg transition z-50 relative"
      aria-label="è³¼ç‰©è»Š">
      <svg v-if="cart.length === 0" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.6 8h13.2M7 13L5.4 5M9 21a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z" />
      </svg>
      <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor"
        viewBox="0 0 24 24">
        <path d="M7 4h-2l-1 2h2l1-2zm1 2h10l4 8H7l1-8zm0 10h10v2H8v-2zm1 4a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z"/>
      </svg>
      <span v-if="cart.length > 0"
        class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1">
        {{ cart.length }}
      </span>
    </button>

    <!-- è¨‚å–®é€å‡ºå¾Œæç¤º -->
    <div v-if="orderSubmitted" class="mt-6 text-blue-700 font-semibold text-center">
      è¨‚å–®å·²é€å‡ºï¼ç·¨è™Ÿï¼š{{ lastOrderId }}ï¼Œæ¡Œè™Ÿï¼š{{ lastTableNumber }}ï¼Œæ„Ÿè¬æ‚¨çš„é»é¤ ğŸ™Œ
    </div>
  </div>

  <script>
    // Firebase åˆå§‹åŒ–
    const firebaseConfig = {
      apiKey: "AIzaSyAEpf1ffQFht5yBm-xCBBMVsdxjzbVhsBg",
      authDomain: "louis-breakfast-tpe.firebaseapp.com",
      projectId: "louis-breakfast-tpe",
      storageBucket: "louis-breakfast-tpe.appspot.com",
      messagingSenderId: "707080689547",
      appId: "1:707080689547:web:ca293380046a59e7de818e",
      measurementId: "G-P4FXJC40KP"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const { createApp } = Vue;

    createApp({
      data() {
        return {
          menu: [],
          cart: [],
          tableNumber: '',
          lastTableNumber: '',
          lastOrderId: '',
          orderCounter: 1,
          showCartPanel: false,
          orderSubmitted: false,
          loading: true
        };
      },
      computed: {
        total() {
          return this.cart.reduce((sum, item) => sum + Number(item.price), 0);
        },
        sortedMenu() {
          return this.menu
            .filter(item => item.available !== false)
            .sort((a, b) => a.id.localeCompare(b.id, 'zh-Hant', { numeric: true }));
        }
      },
      methods: {
        addToCart(item) {
          this.cart.push(item);
        },
        removeFromCart(index) {
          this.cart.splice(index, 1);
        },
        toggleCartPanel() {
          this.showCartPanel = !this.showCartPanel;
        },
        submitOrder() {
          const today = new Date();
          const yyyy = today.getFullYear();
          const mm = String(today.getMonth() + 1).padStart(2, '0');
          const dd = String(today.getDate()).padStart(2, '0');
          const dateStr = `${yyyy}${mm}${dd}`;
          const serial = String(this.orderCounter).padStart(4, '0');
          this.lastOrderId = `${dateStr}${serial}`;
          this.lastTableNumber = this.tableNumber;

          console.log("è¨‚å–®ç·¨è™Ÿï¼š", this.lastOrderId);
          console.log("æ¡Œè™Ÿï¼š", this.lastTableNumber);
          console.log("è¨‚å–®å…§å®¹ï¼š", this.cart);

          this.orderCounter++;
         
