<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>路易士早餐吧｜訂單管理</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.15/dist/vue.global.prod.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>body { font-family: 'Noto Sans TC', sans-serif; }</style>
</head>
<body class="bg-gray-50">
  <div id="app" class="p-6 max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold text-blue-900 mb-6 text-center">📦 路易士早餐吧｜訂單管理</h1>

    <div v-if="orders.length === 0" class="text-center text-gray-500">目前尚無訂單</div>
    <ul>
      <li v-for="order in sortedOrders" :key="order.orderId"
        class="bg-white p-4 mb-4 rounded shadow">
        <div class="font-bold text-blue-800">訂單編號：{{ order.orderId }}</div>
        <div class="text-sm text-gray-600">桌號：{{ order.tableNumber }}</div>
        <div class="text-sm text-gray-600">狀態：{{ order.status }}</div>
        <div class="text-sm text-gray-400">時間：{{ formatTimestamp(order.createdAt) }}</div>

        <div class="mt-2 text-sm text-gray-700">
          <div class="font-semibold mb-1">品項：</div>
          <ul class="list-disc pl-5">
            <li v-for="item in order.items">{{ item.name }} - NT$ {{ item.price }}</li>
          </ul>
        </div>

        <div class="mt-2 font-bold text-blue-700">總金額：NT$ {{ order.total }}</div>

        <div class="mt-2 space-x-2">
          <button v-if="order.status !== '完成'" @click="markOrderComplete(order)"
            class="text-sm bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">
            標記為完成
          </button>
          <button @click="deleteOrder(order)"
            class="text-sm bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">
            刪除訂單
          </button>
        </div>
      </li>
    </ul>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAEpf1ffQFht5yBm-xCBBMVsdxjzbVhsBg",
      authDomain: "louis-breakfast-tpe.firebaseapp.com",
      projectId: "louis-breakfast-tpe",
      storageBucket: "louis-breakfast-tpe.appspot.com",
      messagingSenderId: "707080689547",
      appId: "1:707080689547:web:ca293380046a59e7de818e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          orders: []
        };
      },
      computed: {
        sortedOrders() {
          return this.orders.slice().sort((a, b) => {
            const ta = a.createdAt?.seconds || 0;
            const tb = b.createdAt?.seconds || 0;
            return tb - ta;
          });
        }
      },
      methods: {
        markOrderComplete(order) {
          db.collection("orders").doc(order._docId).update({
            status: "完成"
          });
        },
        deleteOrder(order) {
          db.collection("orders").doc(order._docId).delete();
        },
        formatTimestamp(ts) {
          if (!ts?.seconds) return "無時間資料";
          const date = new Date(ts.seconds * 1000);
          return date.toLocaleString("zh-TW", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit"
          });
        }
      },
      mounted() {
        db.collection("orders").onSnapshot(snap => {
          this.orders = snap.docs.map(doc => {
            const data = doc.data();
            data._docId = doc.id;
            return data;
          });
        });
      }
    }).mount("#app");
  </script>
</body>
</html>
